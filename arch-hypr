#!/usr/bin/env bash
sudo pacman -Suy
sudo pacman -S --noconfirm --needed power-profiles-daemon bluez blueman acpi_call linux-headers acpid fwupd mesa libva-mesa-driver mesa-vdpau vulkan-mesa-layers vulkan-intel vulkan-radeon fprintd intltool xdg-utils dbus brightnessctl ca-certificates jq

sudo pacman -S --noconfirm --needed wpa_supplicant dnsmasq openresolv nss-mdns wireguard-tools ufw openvpn networkmanager-openvpn openssh libxcrypt-compat samba dnsutils nfs-utils modemmanager avahi

sudo pacman -S --noconfirm --needed wireguard-tools reflector openssh fastfetch btop rsync curl wget cups cups-pdf flatpak

sudo systemctl enable --now cups.socket

# Add rule for printing by users
sudo touch /etc/polkit-1/rules.d/49-allow-passwordless-printer-admin.rules
sudo bash -c 'cat << EOF > /etc/polkit-1/rules.d/49-allow-passwordless-printer-admin.rules
polkit.addRule(function(action, subject) {
    if (action.id == "org.opensuse.cupspkhelper.mechanism.all-edit" &&
        subject.isInGroup("wheel")){
        return polkit.Result.YES;
    }
});
EOF'

# Fix mdns printing
sudo sed -i 's/hosts\:\ mymachines\ resolve\ \[\!UNAVAIL\=return\]\ files\ myhostname\ dns/hosts: mymachines mdns [NOTFOUND=return] resolve [!UNAVAIL=return] files myhostname dns/g' /etc/nsswitch.conf


sudo pacman -S --noconfirm --needed git tig neovim less golang cmake gettext 

sudo sed -i 's/\#Experimental\ \=\ false/Experimental\ =\ true/g' /etc/bluetooth/main.conf
sudo systemctl enable --now bluetooth
sudo pacman -S --noconfirm --needed pipewire pipewire-audio pipewire-pulse pipewire-jack pavucontrol wireplumber

# Install Fonts
sudo pacman -S --noconfirm --needed ttf-ibm-plex ttf-liberation ttf-dejavu noto-fonts noto-fonts-extra noto-fonts-emoji ttf-carlito ttf-croscore ttf-hack ttf-anonymous-pro ttf-droid ttf-fira-code ttf-fira-mono ttf-fira-sans ttf-font-awesome ttf-jetbrains-mono ttf-opensans ttf-roboto ttf-roboto-mono nerd-fonts otf-font-awesome

# Install Hyprland
sudo pacman -S --needed --noconfirm gtk3 hyprland hyprlock hyprpolkitagent hypridle hyprpaper dunst slurp grim swappy rofi waybar ghostty dolphin thunderbird firefox xdg-desktop-portal-hyprland xdg-desktop-portal-gtk wl-clipboard feh

# Install Apps
 sudo pacman -S --needed --noconfirm cmus libreoffice mpv mc evince
